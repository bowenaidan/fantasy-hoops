<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <title>Fantasy Hoops Standings</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg-gradient-start: #0f172a;
        --bg-gradient-end: #1e293b;
        --card-bg: rgba(15, 23, 42, 0.75);
        --card-border: rgba(148, 163, 184, 0.2);
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.15);
        --table-header-bg: rgba(56, 189, 248, 0.12);
        --table-row-hover: rgba(56, 189, 248, 0.08);
        --table-border: rgba(148, 163, 184, 0.25);
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg-gradient-start: #f8fafc;
          --bg-gradient-end: #e2e8f0;
          --card-bg: rgba(255, 255, 255, 0.92);
          --card-border: rgba(15, 23, 42, 0.08);
          --text-primary: #0f172a;
          --text-secondary: #475569;
          --accent: #0284c7;
          --accent-soft: rgba(2, 132, 199, 0.12);
          --table-header-bg: rgba(2, 132, 199, 0.1);
          --table-row-hover: rgba(2, 132, 199, 0.08);
          --table-border: rgba(15, 23, 42, 0.08);
        }
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(160deg, var(--bg-gradient-start), var(--bg-gradient-end));
        min-height: 100vh;
        display: flex;
        align-items: stretch;
        justify-content: center;
        color: var(--text-primary);
        padding: 48px 24px;
      }

      .container {
        width: min(1200px, 100%);
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      header {
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.25);
        backdrop-filter: blur(12px);
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 3vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.01em;
      }

      .subheading {
        font-size: 1rem;
        color: var(--text-secondary);
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-weight: 600;
        font-size: 0.85rem;
        letter-spacing: 0.02em;
      }

      .card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        padding: 24px;
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.2);
        backdrop-filter: blur(10px);
      }

      .manager-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .manager-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 20px;
        border-radius: 18px;
        border: 1px solid var(--card-border);
        background: rgba(56, 189, 248, 0.08);
        transition: transform 0.2s ease, background 0.2s ease;
      }

      .manager-item:nth-child(odd) {
        background: rgba(56, 189, 248, 0.12);
      }

      .manager-item:hover {
        transform: translateY(-2px);
        background: rgba(56, 189, 248, 0.18);
      }

      .manager-main {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .manager-name {
        font-size: 1.05rem;
        font-weight: 600;
        letter-spacing: 0.01em;
      }

      .manager-score {
        font-size: 1.15rem;
        font-weight: 700;
        color: var(--accent);
        letter-spacing: 0.02em;
        white-space: nowrap;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .manager-score-label {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 700;
      }

      .manager-breakdown {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .score-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.15);
        color: var(--text-secondary);
        font-size: 0.8rem;
        font-weight: 500;
      }

      .score-pill__label {
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .score-pill__value {
        font-weight: 600;
        color: var(--text-primary);
      }

      .empty-state {
        text-align: center;
        padding: 48px 24px;
        color: var(--text-secondary);
        font-size: 1.05rem;
      }

      .scoreboard-table-wrapper {
        margin-top: 28px;
        border: 1px solid var(--card-border);
        border-radius: 20px;
        overflow: hidden;
      }

      .scoreboard-scroll {
        overflow-x: auto;
      }

      .score-table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(15, 23, 42, 0.35);
      }

      .score-table thead {
        background: var(--table-header-bg);
        backdrop-filter: blur(8px);
      }

      .score-table th,
      .score-table td {
        padding: 14px 18px;
        text-align: left;
        border-bottom: 1px solid var(--table-border);
      }

      .score-table th {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
      }

      .score-table tbody tr:last-child td {
        border-bottom: none;
      }

      .score-table tbody tr:hover {
        background: var(--table-row-hover);
      }

      .score-table td {
        font-size: 0.95rem;
        font-weight: 500;
      }

      .score-table th:first-child,
      .score-table td:first-child {
        position: sticky;
        left: 0;
        background: inherit;
        backdrop-filter: blur(8px);
        z-index: 1;
      }

      .is-primary-score {
        color: var(--accent);
        font-weight: 700;
      }

      footer {
        text-align: right;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      @media (max-width: 768px) {
        body {
          padding: 32px 16px;
        }

        header,
        .card {
          padding: 24px;
          border-radius: 20px;
        }

        .manager-item {
          padding: 16px;
          border-radius: 16px;
        }

        .manager-name {
          font-size: 1rem;
        }

        .manager-score {
          font-size: 1.05rem;
        }
        .manager-main {
          gap: 6px;
        }

        .manager-breakdown {
          gap: 6px;
        }

        .score-table th,
        .score-table td {
          padding: 12px 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="badge">Fantasy Hoops League</div>
        <h1>Current Standings</h1>
        <div class="subheading">
          Updated <?= generatedAt ?>
        </div>
      </header>

      <section class="card">
        <?
          const managerData = (managerScores && typeof managerScores === 'object' && Array.isArray(managerScores.entries))
            ? managerScores
            : {
                headers: [],
                managerColumnIndex: -1,
                scoreColumnIndex: -1,
                entries: Array.isArray(managerScores) ? managerScores : []
              };
          const entries = Array.isArray(managerData.entries) ? managerData.entries : [];
          const headers = Array.isArray(managerData.headers) ? managerData.headers : [];
          const managerColumnIndex = (typeof managerData.managerColumnIndex === 'number') ? managerData.managerColumnIndex : -1;
          const scoreColumnIndex = (typeof managerData.scoreColumnIndex === 'number') ? managerData.scoreColumnIndex : -1;
          const allColumns = headers.map(function(header, idx) {
            var label = (header && header.toString().trim() !== '') ? header : ('Column ' + (idx + 1));
            return { label: label, index: idx };
          });
          const detailColumns = allColumns.filter(function(column) {
            return column.index !== managerColumnIndex;
          }).filter(function(column) {
            return entries.some(function(entry) {
              var row = Array.isArray(entry.row) ? entry.row : [];
              var value = (column.index >= 0 && column.index < row.length) ? row[column.index] : '';
              if (value === null || typeof value === 'undefined') {
                return false;
              }
              if (typeof value === 'string') {
                return value.trim() !== '';
              }
              return value !== '';
            });
          });
          var primaryColumn = null;
          if (scoreColumnIndex !== -1) {
            primaryColumn = detailColumns.find(function(column) { return column.index === scoreColumnIndex; }) || null;
          }
          if (!primaryColumn && detailColumns.length > 0) {
            primaryColumn = detailColumns[0];
          }
          const secondaryColumns = primaryColumn
            ? detailColumns.filter(function(column) { return column.index !== primaryColumn.index; })
            : detailColumns;
        ?>
        <? if (entries.length === 0) { ?>
          <div class="empty-state">
            No manager standings are available right now. Check back soon!
          </div>
        <? } else { ?>
          <ul class="manager-list">
            <? entries.forEach(function(rawEntry) {
                 var entry = (rawEntry && typeof rawEntry === 'object') ? rawEntry : { name: rawEntry, score: '', row: [] };
                 var row = Array.isArray(entry.row) ? entry.row : [];
                 var primaryValue = null;
                 var hasPrimaryValue = false;
                 if (primaryColumn) {
                   primaryValue = (primaryColumn.index >= 0 && primaryColumn.index < row.length) ? row[primaryColumn.index] : '';
                   if (primaryValue === null || typeof primaryValue === 'undefined') {
                     primaryValue = '';
                   }
                   if (typeof primaryValue === 'string') {
                     hasPrimaryValue = primaryValue.trim() !== '';
                   } else {
                     hasPrimaryValue = primaryValue !== '';
                   }
                 }
                 var scoreValue = (typeof entry.score !== 'undefined') ? entry.score : '';
                 var displayScore = hasPrimaryValue ? primaryValue : (scoreValue || scoreValue === 0 ? scoreValue : '');
                 var hasDisplayScore = false;
                 if (typeof displayScore === 'string') {
                   hasDisplayScore = displayScore.trim() !== '';
                 } else {
                   hasDisplayScore = displayScore !== '' && displayScore !== null && typeof displayScore !== 'undefined';
                 }
            ?>
              <li class="manager-item">
                <div class="manager-main">
                  <span class="manager-name"><?!= entry.name ?></span>
                  <? if (secondaryColumns.length > 0) { ?>
                    <div class="manager-breakdown">
                      <? secondaryColumns.forEach(function(column) {
                           var columnValue = (column.index >= 0 && column.index < row.length) ? row[column.index] : '';
                           if (columnValue === null || typeof columnValue === 'undefined') {
                             columnValue = '';
                           }
                           var hasValue = false;
                           if (typeof columnValue === 'string') {
                             hasValue = columnValue.trim() !== '';
                           } else {
                             hasValue = columnValue !== '';
                           }
                           if (!hasValue) {
                             return;
                           }
                      ?>
                        <span class="score-pill">
                          <span class="score-pill__label"><?!= column.label ?></span>
                          <span class="score-pill__value"><?!= columnValue ?></span>
                        </span>
                      <? }); ?>
                    </div>
                  <? } ?>
                </div>
                <span class="manager-score">
                  <? if (primaryColumn) { ?>
                    <span class="manager-score-label"><?!= primaryColumn.label ?></span>
                  <? } ?>
                  <? if (hasDisplayScore) { ?>
                    <?!= displayScore ?>
                  <? } else { ?>
                    &mdash;
                  <? } ?>
                </span>
              </li>
            <? }); ?>
          </ul>
          <? if (detailColumns.length > 0) { ?>
            <div class="scoreboard-table-wrapper">
              <div class="scoreboard-scroll">
                <table class="score-table">
                <thead>
                  <tr>
                    <th scope="col">Manager</th>
                    <? detailColumns.forEach(function(column) { ?>
                      <th scope="col" class="<?!= (column.index === scoreColumnIndex) ? 'is-primary-score' : '' ?>"><?!= column.label ?></th>
                    <? }); ?>
                  </tr>
                </thead>
                <tbody>
                  <? entries.forEach(function(rawEntry) {
                       var entry = (rawEntry && typeof rawEntry === 'object') ? rawEntry : { name: rawEntry, score: '', row: [] };
                       var row = Array.isArray(entry.row) ? entry.row : [];
                  ?>
                    <tr>
                      <th scope="row"><?!= entry.name ?></th>
                      <? detailColumns.forEach(function(column) {
                           var value = (column.index >= 0 && column.index < row.length) ? row[column.index] : '';
                           if (value === null || typeof value === 'undefined') {
                             value = '';
                           }
                           var hasValue = false;
                           if (typeof value === 'string') {
                             hasValue = value.trim() !== '';
                           } else {
                             hasValue = value !== '';
                           }
                           if (!hasValue && column.index === scoreColumnIndex) {
                             var fallbackScore = (typeof entry.score !== 'undefined') ? entry.score : '';
                             if (typeof fallbackScore === 'string') {
                               if (fallbackScore.trim() !== '') {
                                 value = fallbackScore;
                                 hasValue = true;
                               }
                             } else if (fallbackScore !== '' && fallbackScore !== null && typeof fallbackScore !== 'undefined') {
                               value = fallbackScore;
                               hasValue = true;
                             }
                           }
                      ?>
                        <td class="<?!= (column.index === scoreColumnIndex) ? 'is-primary-score' : '' ?>">
                          <? if (hasValue) { ?>
                            <?!= value ?>
                          <? } else { ?>
                            &mdash;
                          <? } ?>
                        </td>
                      <? }); ?>
                    </tr>
                  <? }); ?>
                </tbody>
                </table>
              </div>
            </div>
          <? } ?>
        <? } ?>
      </section>

      <footer>
        Generated directly from the Standings sheet.
      </footer>
    </div>
  </body>
</html>