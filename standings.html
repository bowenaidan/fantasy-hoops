<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <title>Fantasy Hoops Standings</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg-gradient-start: #0f172a;
        --bg-gradient-end: #1e293b;
        --card-bg: rgba(15, 23, 42, 0.75);
        --card-border: rgba(148, 163, 184, 0.2);
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.15);
        --table-header-bg: rgba(56, 189, 248, 0.12);
        --table-row-hover: rgba(56, 189, 248, 0.08);
        --table-border: rgba(148, 163, 184, 0.25);
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg-gradient-start: #f8fafc;
          --bg-gradient-end: #e2e8f0;
          --card-bg: rgba(255, 255, 255, 0.92);
          --card-border: rgba(15, 23, 42, 0.08);
          --text-primary: #0f172a;
          --text-secondary: #475569;
          --accent: #0284c7;
          --accent-soft: rgba(2, 132, 199, 0.12);
          --table-header-bg: rgba(2, 132, 199, 0.1);
          --table-row-hover: rgba(2, 132, 199, 0.08);
          --table-border: rgba(15, 23, 42, 0.08);
        }
      }

      * {
        box-sizing: border-box;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(160deg, var(--bg-gradient-start), var(--bg-gradient-end));
        min-height: 100vh;
        display: flex;
        align-items: stretch;
        justify-content: center;
        color: var(--text-primary);
        padding: 48px 24px;
      }

      .container {
        width: min(1200px, 100%);
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      header {
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.25);
        backdrop-filter: blur(12px);
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 3vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.01em;
      }

      .subheading {
        font-size: 1rem;
        color: var(--text-secondary);
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-weight: 600;
        font-size: 0.85rem;
        letter-spacing: 0.02em;
      }

      .card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        padding: 24px;
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.2);
        backdrop-filter: blur(10px);
      }

      .panel-heading {
        margin: 0 0 14px;
        font-size: 1.1rem;
        font-weight: 700;
        letter-spacing: -0.01em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .tab-controls {
        display: flex;
        justify-content: flex-start;
        align-items: center;
      }

      .tab-list {
        display: inline-flex;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 16px;
        padding: 6px;
        gap: 6px;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);
      }

      .tab-button {
        border: none;
        background: transparent;
        color: var(--text-secondary);
        padding: 10px 16px;
        border-radius: 12px;
        font-weight: 700;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
      }

      .tab-button:hover,
      .tab-button:focus-visible {
        background: var(--accent-soft);
        color: var(--accent);
        outline: none;
        transform: translateY(-1px);
      }

      .tab-button.is-active {
        background: var(--accent);
        color: #0b1224;
        box-shadow: 0 10px 24px rgba(56, 189, 248, 0.35);
      }

      .tab-panel[hidden] {
        display: none;
      }

      .manager-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .manager-item {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 24px;
        padding: 18px 20px;
        border-radius: 18px;
        border: 1px solid var(--card-border);
        background: rgba(56, 189, 248, 0.08);
        transition: transform 0.2s ease, background 0.2s ease;
      }

      .manager-item:nth-child(odd) {
        background: rgba(56, 189, 248, 0.12);
      }

      .manager-item:hover {
        transform: translateY(-2px);
        background: rgba(56, 189, 248, 0.18);
      }

      .manager-main {
        display: flex;
        flex-direction: column;
        gap: 12px;
        flex: 1;
      }

      .manager-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      }

      .manager-name {
        font-size: 1.05rem;
        font-weight: 600;
        letter-spacing: 0.01em;
        background: none;
        border: none;
        color: inherit;
        padding: 0;
        text-align: left;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        flex: 1;
      }

      .manager-name:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 4px;
      }

      .manager-name::after {
        content: '\25BC';
        font-size: 0.75em;
        transition: transform 0.2s ease;
      }

      .manager-score {
        font-size: 1.15rem;
        font-weight: 700;
        color: var(--accent);
        letter-spacing: 0.02em;
        white-space: nowrap;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-top: 0;
        flex-shrink: 0;
      }

      .manager-score-label {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 700;
      }

      .manager-item.is-expanded .manager-name::after {
        transform: rotate(-180deg);
      }

      .manager-details {
        display: none;
        margin-top: 8px;
      }

      .manager-item.is-expanded .manager-details {
        display: block;
      }

      .manager-detail-list {
        display: grid;
        gap: 8px;
        margin-top: 8px;
      }

      .manager-detail-list__item {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 8px;
        align-items: baseline;
        padding: 10px 12px;
        border-radius: 12px;
        background: rgba(148, 163, 184, 0.15);
        border: 1px solid rgba(148, 163, 184, 0.2);
      }

      .manager-detail-list__term {
        margin: 0;
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .manager-detail-list__description {
        margin: 0;
        font-size: 0.95rem;
        color: var(--text-primary);
        font-weight: 600;
      }

      .manager-detail-empty {
        margin-top: 8px;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .manager-teams {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .manager-team-heading {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
        font-weight: 700;
      }

      .manager-team-table-scroll {
        overflow-x: auto;
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        background: rgba(15, 23, 42, 0.2);
      }

      .manager-team-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 320px;
        table-layout: fixed;
      }

      .manager-team-table thead {
        background: var(--table-header-bg);
      }

      .manager-team-table th,
      .manager-team-table td {
        padding: 10px 14px;
        text-align: left;
        border-bottom: 1px solid var(--table-border);
        font-size: 0.9rem;
        word-break: break-word;
      }

      .manager-team-table th {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
      }

      .manager-team-table th.is-primary-score,
      .manager-team-table td.is-primary-score {
        width: 80px;
        text-align: right;
        padding-right: 18px;
        white-space: nowrap;
        font-variant-numeric: tabular-nums;
      }

      .manager-team-table th.is-opponent,
      .manager-team-table td.is-opponent {
        width: 110px;
        padding-left: 10px;
        padding-right: 10px;
      }

      .manager-team-name {
        font-weight: 700;
        /* color: var(--accent); */
      }

      .manager-team-table tbody tr:last-child td {
        border-bottom: none;
      }

      .empty-state {
        text-align: center;
        padding: 48px 24px;
        color: var(--text-secondary);
        font-size: 1.05rem;
      }

      .team-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .team-search {
        margin: 0 0 16px;
        position: sticky;
        top: 0;
        z-index: 5;
        background: var(--card-bg);
        padding: 0 0 12px;
      }

      .team-search input {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid var(--card-border);
        background: rgba(148, 163, 184, 0.1);
        color: var(--text-primary);
        font-size: 1rem;
        outline: none;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      }

      .team-search input::placeholder {
        color: var(--text-secondary);
      }

      .team-search input:focus-visible {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-soft);
        background: rgba(56, 189, 248, 0.12);
      }

      .team-item {
        border: 1px solid var(--card-border);
        border-radius: 18px;
        padding: 16px 18px;
        background: rgba(148, 163, 184, 0.08);
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .team-item-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .team-name-with-rank {
        font-weight: 700;
        letter-spacing: 0.01em;
        font-size: 1rem;
      }

      .team-points {
        display: inline-flex;
        align-items: baseline;
        gap: 6px;
        color: var(--accent);
        font-weight: 800;
        font-size: 1rem;
        white-space: nowrap;
      }

      .team-points-label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .team-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .team-chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.15);
        border: 1px solid rgba(148, 163, 184, 0.2);
        font-weight: 600;
        color: var(--text-primary);
      }

      .scoreboard-table-wrapper {
        margin-top: 28px;
        border: 1px solid var(--card-border);
        border-radius: 20px;
        overflow: hidden;
      }

      .scoreboard-scroll {
        overflow-x: auto;
      }

      .score-table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(15, 23, 42, 0.35);
      }

      .score-table thead {
        background: var(--table-header-bg);
        backdrop-filter: blur(8px);
      }

      .score-table th,
      .score-table td {
        padding: 14px 18px;
        text-align: left;
        border-bottom: 1px solid var(--table-border);
      }

      .score-table th {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
      }

      .score-table tbody tr:last-child td {
        border-bottom: none;
      }

      .score-table tbody tr:hover {
        background: var(--table-row-hover);
      }

      .score-table td {
        font-size: 0.95rem;
        font-weight: 500;
      }

      .score-table th:first-child,
      .score-table td:first-child {
        position: sticky;
        left: 0;
        background: inherit;
        backdrop-filter: blur(8px);
        z-index: 1;
      }

      .is-primary-score {
        color: var(--accent);
        font-weight: 700;
      }

      footer {
        text-align: right;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      @media (max-width: 768px) {
        body {
          padding: 32px 16px;
        }

        header,
        .card {
          padding: 12px;
          border-radius: 20px;
        }

        .manager-item {
          padding: 8px;
          border-radius: 16px;
          align-items: center;
          gap: 12px;
        }

        .manager-name {
          font-size: 1rem;
        }

        .manager-header {
          gap: 10px;
        }

        .manager-score {
          font-size: 1.05rem;
          margin-top: 0;
          align-self: center;
        }
        .manager-main {
          gap: 6px;
        }

        .manager-details {
          margin-top: 6px;
        }

        .manager-detail-list {
          gap: 6px;
        }

        .manager-team-table {
          min-width: 0;
        }

        .manager-team-table th,
        .manager-team-table td {
          padding: 10px 10px;
          font-size: 0.85rem;
        }

        .manager-team-table th.is-primary-score,
        .manager-team-table td.is-primary-score {
          width: 64px;
          padding-right: 16px;
        }

        .manager-team-table th.is-opponent,
        .manager-team-table td.is-opponent {
          width: 96px;
          padding-left: 8px;
          padding-right: 8px;
        }

        .score-table th,
        .score-table td {
          padding: 12px 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="badge">Fantasy Hoops League</div>
        <h1>Current Standings</h1>
        <div class="subheading">
          Updated <?= generatedAt ?>
        </div>
      </header>
      <div class="tab-controls">
        <div class="tab-list" role="tablist">
          <button type="button" class="tab-button is-active" data-tab-target="manager-panel" aria-controls="manager-panel" role="tab" aria-selected="true">Managers</button>
          <button type="button" class="tab-button" data-tab-target="team-panel" aria-controls="team-panel" role="tab" aria-selected="false">Teams</button>
        </div>
      </div>

      <section class="card tab-panel" id="manager-panel">
        <div class="panel-heading">Managers</div>
        <?
          const managerData = (managerScores && typeof managerScores === 'object' && Array.isArray(managerScores.entries))
            ? managerScores
            : {
                headers: [],
                managerColumnIndex: -1,
                scoreColumnIndex: -1,
                entries: Array.isArray(managerScores) ? managerScores : []
              };
          const entries = Array.isArray(managerData.entries) ? managerData.entries : [];
          const headers = Array.isArray(managerData.headers) ? managerData.headers : [];
          const managerColumnIndex = (typeof managerData.managerColumnIndex === 'number') ? managerData.managerColumnIndex : -1;
          const scoreColumnIndex = (typeof managerData.scoreColumnIndex === 'number') ? managerData.scoreColumnIndex : -1;
          const allColumns = headers.map(function(header, idx) {
            var label = (header && header.toString().trim() !== '') ? header : ' ';
            return { label: label, index: idx };
          });
          const normalizedHeaders = headers.map(function(header) {
            return (header || '').toString().trim().toLowerCase();
          });
          var opponentColumnIndex = normalizedHeaders.findIndex(function(header) {
            return header === 'opponent' || header === 'opp' || header.indexOf('opponent') !== -1;
          });
          if (opponentColumnIndex === -1 && scoreColumnIndex >= 0 && (scoreColumnIndex + 1) < headers.length) {
            opponentColumnIndex = scoreColumnIndex + 1;
          }
          const detailColumns = allColumns.filter(function(column) {
            return column.index !== managerColumnIndex;
          }).filter(function(column) {
            return entries.some(function(entry) {
              var row = Array.isArray(entry.row) ? entry.row : [];
              var value = (column.index >= 0 && column.index < row.length) ? row[column.index] : '';
              if (value === null || typeof value === 'undefined') {
                return false;
              }
              if (typeof value === 'string') {
                return value.trim() !== '';
              }
              return value !== '';
            });
          });
          var primaryColumn = null;
          if (scoreColumnIndex !== -1) {
            primaryColumn = detailColumns.find(function(column) { return column.index === scoreColumnIndex; }) || null;
          }
          if (!primaryColumn && detailColumns.length > 0) {
            primaryColumn = detailColumns[0];
          }
        ?>
        <? if (entries.length === 0) { ?>
          <div class="empty-state">
            No manager standings are available right now. Check back soon!
          </div>
        <? } else { ?>
          <ul class="manager-list">
            <? entries.forEach(function(rawEntry) {
                 var entry = (rawEntry && typeof rawEntry === 'object') ? rawEntry : { name: rawEntry, score: '', row: [] };
                 var row = Array.isArray(entry.row) ? entry.row : [];
                 var primaryValue = null;
                 var hasPrimaryValue = false;
                 if (primaryColumn) {
                   primaryValue = (primaryColumn.index >= 0 && primaryColumn.index < row.length) ? row[primaryColumn.index] : '';
                   if (primaryValue === null || typeof primaryValue === 'undefined') {
                     primaryValue = '';
                   }
                   if (typeof primaryValue === 'string') {
                     hasPrimaryValue = primaryValue.trim() !== '';
                   } else {
                     hasPrimaryValue = primaryValue !== '';
                   }
                 }
                 var scoreValue = (typeof entry.score !== 'undefined') ? entry.score : '';
                 var displayScore = hasPrimaryValue ? primaryValue : (scoreValue || scoreValue === 0 ? scoreValue : '');
                 var hasDisplayScore = false;
                 if (typeof displayScore === 'string') {
                   hasDisplayScore = displayScore.trim() !== '';
                 } else {
                   hasDisplayScore = displayScore !== '' && displayScore !== null && typeof displayScore !== 'undefined';
                 }
            ?>
              <li class="manager-item">
                <div class="manager-main">
                  <?
                    var detailIdBase = (entry.name || '').toString().toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
                    if (!detailIdBase) {
                      detailIdBase = 'manager';
                    }
                    var detailId = detailIdBase + '-' + Math.random().toString(36).slice(2, 8);
                  ?>
                  <div class="manager-header">
                    <button type="button" class="manager-name" aria-expanded="false" aria-controls="<?!= detailId ?>">
                      <?!= entry.name ?>
                    </button>
                    <span class="manager-score">
                      <? if (primaryColumn) { ?>
                        <span class="manager-score-label"><?!= primaryColumn.label ?></span>
                      <? } ?>
                      <? if (hasDisplayScore) { ?>
                        <?!= displayScore ?>
                      <? } else { ?>
                        &mdash;
                      <? } ?>
                    </span>
                  </div>
                  <?
                    var detailValues = [];
                    detailColumns.forEach(function(column) {
                      if (primaryColumn && column.index === primaryColumn.index) {
                        return;
                      }
                      var columnValue = (column.index >= 0 && column.index < row.length) ? row[column.index] : '';
                      if (columnValue === null || typeof columnValue === 'undefined') {
                        columnValue = '';
                      }
                      var hasValue = false;
                      if (typeof columnValue === 'string') {
                        hasValue = columnValue.trim() !== '';
                      } else {
                        hasValue = columnValue !== '' && columnValue !== null;
                      }
                      if (!hasValue && column.index === scoreColumnIndex) {
                        var fallbackScoreValue = (typeof entry.score !== 'undefined') ? entry.score : '';
                        if (typeof fallbackScoreValue === 'string') {
                          hasValue = fallbackScoreValue.trim() !== '';
                        } else {
                          hasValue = fallbackScoreValue !== '' && fallbackScoreValue !== null && typeof fallbackScoreValue !== 'undefined';
                        }
                        if (hasValue) {
                          columnValue = fallbackScoreValue;
                        }
                      }
                      if (!hasValue) {
                        return;
                      }
                      detailValues.push({
                        label: column.label,
                        value: columnValue
                      });
                    });

                    var teamRows = Array.isArray(entry.teams) ? entry.teams : [];
                    var columnHasTeamValue = function(columnIndex) {
                      return teamRows.some(function(teamRow) {
                        if (!Array.isArray(teamRow)) {
                          return false;
                        }
                        var value = (columnIndex >= 0 && columnIndex < teamRow.length) ? teamRow[columnIndex] : '';
                        if (value === null || typeof value === 'undefined') {
                          return false;
                        }
                        if (typeof value === 'string') {
                          return value.trim() !== '';
                        }
                        return value !== '' && value !== null;
                      });
                    };

                    var prioritizeTeamColumns = function(columns) {
                      if (!Array.isArray(columns)) {
                        return [];
                      }
                      var ordered = [];
                      var addIfPresent = function(column) {
                        if (column && ordered.indexOf(column) === -1) {
                          ordered.push(column);
                        }
                      };
                      var managerColumn = columns.find(function(column) {
                        return column.index === managerColumnIndex;
                      });
                      var scoreColumn = columns.find(function(column) {
                        return column.index === scoreColumnIndex;
                      });
                      addIfPresent(managerColumn);
                      addIfPresent(scoreColumn);
                      columns.forEach(function(column) {
                        addIfPresent(column);
                      });
                      return ordered;
                    };

                      var teamColumns = [];
                      if (teamRows.length > 0) {
                        teamColumns = allColumns.filter(function(column) {
                          if (column.index === opponentColumnIndex) {
                            return false;
                          }
                          if (column.index === managerColumnIndex) {
                            return true;
                          }
                          if (column.index === scoreColumnIndex) {
                            return true;
                          }
                          return columnHasTeamValue(column.index);
                        });
                        if (teamColumns.length === 0) {
                          teamColumns = allColumns.filter(function(column) {
                            return column.index === managerColumnIndex || column.index === scoreColumnIndex;
                          });
                        }
                        teamColumns = prioritizeTeamColumns(teamColumns);
                      }
                  ?>
                  <div id="<?!= detailId ?>" class="manager-details" hidden>
                    <? if (detailValues.length > 0) { ?>
                      <dl class="manager-detail-list">
                        <? detailValues.forEach(function(detail) { ?>
                          <div class="manager-detail-list__item">
                            <dt class="manager-detail-list__term"><?!= detail.label ?></dt>
                            <dd class="manager-detail-list__description"><?!= detail.value ?></dd>
                          </div>
                        <? }); ?>
                      </dl>
                    <? } ?>
                    <? if (teamRows.length > 0 && teamColumns.length > 0) { ?>
                      <div class="manager-teams">
                        <div class="manager-team-heading">Team Breakdown</div>
                        <div class="manager-team-table-scroll">
                          <table class="manager-team-table">
                            <thead>
                              <tr>
                                <? teamColumns.forEach(function(column) {
                                     var headingLabel = column.label;
                                     var normalizedLabel = (headingLabel || '').toString().trim().toLowerCase();
                                     if (column.index === managerColumnIndex && (normalizedLabel.indexOf('manager') !== -1 || normalizedLabel.indexOf('name') !== -1)) {
                                       headingLabel = 'Team';
                                     }
                                     var headingClasses = [];
                                     if (column.index === scoreColumnIndex) {
                                       headingClasses.push('is-primary-score');
                                     }
                                     var headingClassName = headingClasses.join(' ');
                                ?>
                                  <th scope="col" class="<?!= headingClassName ?>"><?!= headingLabel ?></th>
                                <? }); ?>
                              </tr>
                            </thead>
                            <tbody>
                              <? teamRows.forEach(function(teamRow) { ?>
                                <tr>
                                  <? teamColumns.forEach(function(column) {
                                       var value = (column.index >= 0 && column.index < teamRow.length) ? teamRow[column.index] : '';
                                       if (value === null || typeof value === 'undefined') {
                                         value = '';
                                       }
                                       var opponentValue = (opponentColumnIndex >= 0 && opponentColumnIndex < teamRow.length) ? teamRow[opponentColumnIndex] : '';
                                       if (opponentValue === null || typeof opponentValue === 'undefined') {
                                         opponentValue = '';
                                       }
                                       var opponentText = opponentValue.toString().trim();
                                       if (column.index === managerColumnIndex) {
                                         var baseText = value.toString().trim();
                                         var managerText = baseText ? '<span class="manager-team-name">' + baseText + '</span>' : '';
                                         if (opponentText !== '') {
                                           if (managerText && opponentText) {
                                             value = managerText + ' ' + opponentText;
                                           } else if (managerText) {
                                             value = managerText;
                                           } else {
                                             value = opponentText;
                                           }
                                         } else if (managerText) {
                                           value = managerText;
                                         }
                                       }
                                       var hasValue = false;
                                       if (typeof value === 'string') {
                                         hasValue = value.trim() !== '';
                                       } else {
                                         hasValue = value !== '' && value !== null && typeof value !== 'undefined';
                                       }
                                       if (!hasValue && column.index === scoreColumnIndex) {
                                         hasValue = value === 0;
                                       }
                                       var cellClasses = [];
                                       if (column.index === scoreColumnIndex) {
                                         cellClasses.push('is-primary-score');
                                       }
                                       var cellClassName = cellClasses.join(' ');
                                  ?>
                                    <td class="<?!= cellClassName ?>">
                                      <? if (hasValue) { ?>
                                        <?!= value ?>
                                      <? } else { ?>
                                        &mdash;
                                      <? } ?>
                                    </td>
                                  <? }); ?>
                                </tr>
                              <? }); ?>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    <? } ?>
                    <? if (detailValues.length === 0 && (!teamRows || teamRows.length === 0)) { ?>
                      <div class="manager-detail-empty">No additional details available.</div>
                    <? } ?>
                  </div>
                </div>
              </li>
            <? }); ?>
          </ul>
        <? } ?>
      </section>

      <section class="card tab-panel" id="team-panel" hidden>
        <div class="panel-heading">Teams</div>
        <? if (teamEntries && teamEntries.length > 0) { ?>
          <div class="team-search">
            <label class="sr-only" for="team-search-input">Search teams</label>
            <input id="team-search-input" type="search" placeholder="Search by team, owner, opponent, or rank" aria-label="Search teams">
          </div>
          <ul class="team-list">
            <? teamEntries.forEach(function(teamEntry) { ?>
              <?
                var teamName = (teamEntry.team || '').toString().trim();
                var rankText = (teamEntry.rank || '').toString().trim();
                var displayName = teamName;
                if (rankText !== '') {
                  displayName = teamName ? (teamName + ' (' + rankText + ')') : '(' + rankText + ')';
                }
                var rawPoints = teamEntry.points;
                var hasPoints = !(rawPoints === '' || typeof rawPoints === 'undefined' || rawPoints === null);
                if (!hasPoints && rawPoints === 0) {
                  hasPoints = true;
                }
                var pointsText = hasPoints ? rawPoints : '';
                var ownerText = (teamEntry.owner || '').toString().trim();
                var opponentText = (teamEntry.opponent || '').toString().trim();
                var searchTokens = [displayName, ownerText, opponentText, rankText, pointsText]
                  .filter(function(value) { return value !== null && typeof value !== 'undefined'; })
                  .map(function(value) { return value.toString().trim(); })
                  .filter(function(text) { return text !== ''; })
                  .join(' ') || '';
              ?>
              <li class="team-item" data-search-text="<?!= searchTokens.toLowerCase() ?>">
                <div class="team-item-header">
                  <div class="team-name-with-rank"><?!= displayName || 'Team' ?></div>
                  <div class="team-points">
                    <? if (hasPoints) { ?>
                      <span class="team-points-value"><?!= pointsText ?></span>
                      <span class="team-points-label">pts</span>
                    <? } else { ?>
                      <span>&mdash;</span>
                    <? } ?>
                  </div>
                </div>
                <div class="team-meta">
                  <? if (ownerText) { ?>
                    <span class="team-chip">Owner: <?!= ownerText ?></span>
                  <? } ?>
                  <? if (opponentText) { ?>
                    <span class="team-chip">Opp: <?!= opponentText ?></span>
                  <? } ?>
                </div>
              </li>
            <? }); ?>
          </ul>
        <? } else { ?>
          <div class="empty-state">No team data available.</div>
        <? } ?>
      </section>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var items = document.querySelectorAll('.manager-item');
        items.forEach(function(item) {
          var toggle = item.querySelector('.manager-name');
          var details = item.querySelector('.manager-details');
          if (!toggle || !details) {
            return;
          }
          var setExpanded = function(expanded) {
            if (expanded) {
              item.classList.add('is-expanded');
              toggle.setAttribute('aria-expanded', 'true');
              details.removeAttribute('hidden');
            } else {
              item.classList.remove('is-expanded');
              toggle.setAttribute('aria-expanded', 'false');
              details.setAttribute('hidden', '');
            }
          };
          toggle.addEventListener('click', function() {
            setExpanded(!item.classList.contains('is-expanded'));
          });
          setExpanded(false);
        });

        var tabButtons = document.querySelectorAll('[data-tab-target]');
        var panels = document.querySelectorAll('.tab-panel');
        tabButtons.forEach(function(button) {
          button.addEventListener('click', function() {
            var targetId = button.getAttribute('data-tab-target');
            tabButtons.forEach(function(btn) {
              var isActive = btn === button;
              btn.classList.toggle('is-active', isActive);
              btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });
            panels.forEach(function(panel) {
              var isMatch = panel.id === targetId;
              panel.classList.toggle('is-active', isMatch);
              if (isMatch) {
                panel.removeAttribute('hidden');
              } else {
                panel.setAttribute('hidden', '');
              }
            });
          });
        });

        var searchInput = document.getElementById('team-search-input');
        var teamItems = Array.prototype.slice.call(document.querySelectorAll('.team-item'));
        var teamList = document.querySelector('.team-list');

        var applyTeamFilter = function(query) {
          var normalized = (query || '').toString().trim().toLowerCase();
          var anyVisible = false;

          teamItems.forEach(function(item) {
            var haystack = item.getAttribute('data-search-text') || '';
            var matches = normalized === '' || haystack.indexOf(normalized) !== -1;
            item.style.display = matches ? '' : 'none';
            if (matches) {
              anyVisible = true;
            }
          });

          if (teamList) {
            teamList.setAttribute('data-has-results', anyVisible ? 'true' : 'false');
          }
        };

        if (searchInput) {
          searchInput.addEventListener('input', function(event) {
            applyTeamFilter(event.target.value);
          });
          applyTeamFilter('');
        }
      });
    </script>
  </body>
</html>