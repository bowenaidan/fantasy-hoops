<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fantasy Hoops Teams</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg-gradient-start: #0f172a;
      --bg-gradient-end: #1e293b;
      --card-bg: rgba(15, 23, 42, 0.75);
      --card-border: rgba(148, 163, 184, 0.2);
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --table-header-bg: rgba(56, 189, 248, 0.12);
      --table-row-hover: rgba(56, 189, 248, 0.08);
      --table-border: rgba(148, 163, 184, 0.25);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg-gradient-start: #f8fafc;
        --bg-gradient-end: #e2e8f0;
        --card-bg: rgba(255, 255, 255, 0.92);
        --card-border: rgba(15, 23, 42, 0.08);
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --accent: #0284c7;
        --accent-soft: rgba(2, 132, 199, 0.12);
        --table-header-bg: rgba(2, 132, 199, 0.1);
        --table-row-hover: rgba(2, 132, 199, 0.08);
        --table-border: rgba(15, 23, 42, 0.08);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(160deg, var(--bg-gradient-start), var(--bg-gradient-end));
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      color: var(--text-primary);
      padding: 48px 24px;
    }

    .container {
      width: min(1200px, 100%);
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.2);
      backdrop-filter: blur(10px);
    }

    .page-header {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    h1 {
      margin: 0;
      font-size: clamp(2rem, 3vw, 3rem);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .subheading {
      font-size: 1rem;
      color: var(--text-secondary);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin: 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
      font-size: 0.85rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .tab-controls {
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }

    .tab-list {
      display: inline-flex;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 6px;
      gap: 6px;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);
    }

    .tab-button {
      border: none;
      background: transparent;
      color: var(--text-secondary);
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 700;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
      font-size: 1rem;
    }

    .tab-button:hover,
    .tab-button:focus-visible {
      background: var(--accent-soft);
      color: var(--accent);
      outline: none;
      transform: translateY(-1px);
    }

    .tab-button.is-active {
      background: var(--accent);
      color: #0b1224;
      box-shadow: 0 10px 24px rgba(56, 189, 248, 0.35);
    }

    .tab-panel[hidden] {
      display: none;
    }

    .tab-panel {
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    h2 {
      margin: 0;
      font-size: 1.5rem;
      letter-spacing: -0.01em;
    }

    .search-bar {
      margin: 0 0 8px;
      position: sticky;
      top: 0;
      z-index: 5;
      background: transparent;
    }

    .search-input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: rgba(148, 163, 184, 0.1);
      color: var(--text-primary);
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .search-input::placeholder {
      color: var(--text-secondary);
    }

    .search-input:focus-visible {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
      background: rgba(56, 189, 248, 0.12);
    }

    .manager-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    details.manager-dropdown {
      border: 1px solid var(--card-border);
      border-radius: 18px;
      background: rgba(56, 189, 248, 0.08);
      transition: transform 0.2s ease, background 0.2s ease;
      overflow: hidden;
    }

    details.manager-dropdown:nth-child(odd) {
      background: rgba(56, 189, 248, 0.12);
    }

    details.manager-dropdown[open] {
      background: rgba(56, 189, 248, 0.18);
      transform: translateY(-2px);
    }

    .manager-summary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 18px 20px;
      cursor: pointer;
      list-style: none;
    }

    .manager-summary::-webkit-details-marker {
      display: none;
    }

    .manager-name {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      background: none;
      border: none;
      color: inherit;
      padding: 0;
      text-align: left;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .manager-name::after {
      content: '\25BC';
      font-size: 0.75em;
      transition: transform 0.2s ease;
    }

    details[open] .manager-name::after {
      transform: rotate(-180deg);
    }

    .manager-score {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.02em;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin: 0;
    }

    .manager-score-label {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
    }

    .points-gain {
      color: #16a34a;
      font-weight: 700;
    }

    .points-loss {
      color: #ff4d4f;
      font-weight: 700;
    }

    .manager-teams {
      padding: 0 20px 18px;
      background: rgba(15, 23, 42, 0.2);
      border-top: 1px solid var(--card-border);
    }

    .manager-detail-list {
      display: grid;
      gap: 8px;
      margin-top: 8px;
    }

    .manager-detail-list__item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      align-items: baseline;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(148, 163, 184, 0.15);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .manager-detail-list__term {
      margin: 0;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .manager-detail-list__description {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text-primary);
      font-weight: 600;
    }

    .manager-team-heading {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
      font-weight: 700;
      margin: 12px 0 8px;
    }

    .manager-team-table-scroll {
      overflow-x: auto;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 320px;
      table-layout: fixed;
      color: var(--text-primary);
    }

    th,
    td {
      padding: 10px 14px;
      text-align: left;
      border-bottom: 1px solid var(--table-border);
      font-size: 0.95rem;
      word-break: break-word;
    }

    th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
      background: var(--table-header-bg);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody tr:hover {
      background: var(--table-row-hover);
    }

    .manager-team-table th.is-primary-score,
    .manager-team-table td.is-primary-score {
      width: 110px;
      text-align: right;
      padding-right: 18px;
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
    }

    .manager-team-table th.is-opponent,
    .manager-team-table td.is-opponent {
      width: 130px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .manager-team-name {
      font-weight: 700;
    }

    .search-results table,
    .live-scores-table table {
      min-width: 0;
    }

    .empty-state {
      text-align: center;
      padding: 24px 12px;
      color: var(--text-secondary);
      font-size: 1rem;
      margin: 0;
    }

    .team-manager {
      display: block;
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-top: 2px;
    }

    .live-status {
      color: var(--text-secondary);
      display: block;
      margin-top: 4px;
    }

    .error {
      color: #fef2f2;
      background: rgba(248, 113, 113, 0.15);
      padding: 12px 14px;
      border: 1px solid rgba(248, 113, 113, 0.35);
      border-radius: 12px;
      margin-top: 12px;
    }

    @media (max-width: 768px) {
      body {
        padding: 32px 16px;
      }

      .card {
        padding: 16px;
        border-radius: 20px;
      }

      .manager-summary {
        padding: 14px 14px 12px;
        flex-direction: column;
        align-items: flex-start;
      }

      .manager-score {
        font-size: 1.05rem;
        align-self: center;
      }

      .manager-team-table th,
      .manager-team-table td {
        padding: 10px 10px;
        font-size: 0.9rem;
      }

      .manager-team-table th.is-primary-score,
      .manager-team-table td.is-primary-score {
        width: 90px;
        padding-right: 16px;
      }

      .manager-team-table th.is-opponent,
      .manager-team-table td.is-opponent {
        width: 110px;
        padding-left: 8px;
        padding-right: 8px;
      }

      th,
      td {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="page-header card">
      <span class="badge">Fantasy Hoops</span>
      <h1>Teams dashboard</h1>
      <p class="subheading">Track managers, team scores, and live matchups</p>
    </header>

    <div class="card">
      <div class="tab-controls" role="tablist">
        <div class="tab-list">
          <button class="tab-button is-active" data-tab="manager" role="tab" aria-selected="true">By manager</button>
          <button class="tab-button" data-tab="search" role="tab" aria-selected="false">Search teams</button>
          <button class="tab-button" data-tab="scores" role="tab" aria-selected="false">Live Scores</button>
        </div>
      </div>

      <section id="managerTab" class="tab-panel active" aria-label="Teams by manager">
        <h2>Teams by manager</h2>
        <div id="managerDropdowns" class="dropdown-list manager-list"></div>
      </section>

      <section id="searchTab" class="tab-panel" aria-label="Search teams" hidden>
        <h2>Search by team</h2>
        <div class="search-bar">
          <input id="teamSearch" class="search-input" type="search" placeholder="Start typing a team name" aria-label="Search teams" />
        </div>
        <div id="searchResults" class="search-results"></div>
      </section>

      <section id="scoresTab" class="tab-panel" aria-label="Lives Scores" hidden>
        <h2>Live Scores</h2>
        <div id="liveScores"></div>
      </section>
    </div>

    <div id="error" class="error" style="display:none;"></div>
  </div>

  <script>
    const columns = [
      'team',
      'points',
    ];

    const searchColumns = [
      'team',
      'points',
    ];

    const liveScoreColumns = [
      'home',
      'score',
      'away',
    ];

    let allTeams = [];

    function formatColumnName(column) {
      const label = column.replace(/_/g, ' ');
      return label.charAt(0).toUpperCase() + label.slice(1);
    }

    function formatRankedTeam(name, rank) {
      const trimmedName = name ?? '';
      if (!trimmedName) return '';
      return rank ? `${trimmedName} (${rank})` : trimmedName;
    }

    function formatTeamLabel(team) {
      const teamName = team?.team ?? '';
      const rank = team?.rank;
      return rank ? `${teamName} (${rank})` : teamName;
    }

    function getOpponentPrefix(team) {
      const homeFlag = team?.home_game;
      const isHomeGame = homeFlag === true || homeFlag === 'TRUE' || homeFlag === 'true';
      const isAwayGame = homeFlag === false || homeFlag === 'FALSE' || homeFlag === 'false';

      if (isHomeGame) return 'vs';
      if (isAwayGame) return '@';
      return '';
    }

    function formatOpponentLabel(team) {
      const opponentName = team?.opponent ?? '';
      const opponentRank = team?.opponent_rank;
      const prefix = getOpponentPrefix(team);

      if (!opponentName) return '';

      const label = opponentRank ? `${opponentName} (${opponentRank})` : opponentName;
      return prefix ? `${prefix} ${label}` : label;
    }

    function getTotalPoints(team) {
      const base = Number(team?.points) || 0;
      const today = Number(team?.points_today) || 0;
      return base + today;
    }

    function renderManagerDropdowns(managerTotals, teams, managerDailyTotal = []) {
      const dailyByManager = managerDailyTotal.reduce((acc, row) => {
        acc[row.manager] = row.dailyPoints;
        return acc;
      }, {});
      const dropdownList = document.getElementById('managerDropdowns');
      dropdownList.className = 'dropdown-list manager-list';
      dropdownList.innerHTML = '';

      const teamsByManager = teams.reduce((acc, team) => {
        const manager = team?.manager || 'Unassigned';
        if (!acc.has(manager)) {
          acc.set(manager, []);
        }
        acc.get(manager).push(team);
        return acc;
      }, new Map());

      managerTotals.forEach(({ manager, totalPoints }) => {
        const managerTeams = (teamsByManager.get(manager) || []).sort((a, b) => {
          const pointsA = Number(a?.points) || 0;
          const pointsB = Number(b?.points) || 0;
          if (pointsB !== pointsA) return pointsB - pointsA;
          return (a?.team || '').localeCompare(b?.team || '');
        });

        const daily = dailyByManager[manager] ?? 0;

        let dailyHtml = '';

        if (daily > 0) {
          dailyHtml = `<span class="points-gain">+${daily}</span>`;
        } else if (daily < 0) {
          dailyHtml = `<span class="points-loss">${daily}</span>`;
        }

        const details = document.createElement('details');
        details.className = 'manager-dropdown manager-item';

        const summary = document.createElement('summary');
        summary.className = 'manager-summary';
        summary.innerHTML = `
          <div class="manager-header">
            <span class="manager-name">${manager}</span>
            <p class="manager-score">
              <span class="manager-score-label">Total</span>
              ${totalPoints + daily} pts
              ${dailyHtml}
            </p>
          </div>
        `;

        const teamsContainer = document.createElement('div');
        teamsContainer.className = 'manager-teams';

        const detailList = document.createElement('dl');
        detailList.className = 'manager-detail-list';

        const totalItem = document.createElement('div');
        totalItem.className = 'manager-detail-list__item';
        totalItem.innerHTML = `
          <dt class="manager-detail-list__term">Teams</dt>
          <dd class="manager-detail-list__description">${managerTeams.length}</dd>
        `;

        const todayItem = document.createElement('div');
        todayItem.className = 'manager-detail-list__item';
        todayItem.innerHTML = `
          <dt class="manager-detail-list__term">Today</dt>
          <dd class="manager-detail-list__description">${dailyHtml || '0'}</dd>
        `;

        detailList.appendChild(totalItem);
        detailList.appendChild(todayItem);
        teamsContainer.appendChild(detailList);

        if (!managerTeams.length) {
          const empty = document.createElement('p');
          empty.className = 'empty-state';
          empty.textContent = 'No teams assigned to this manager.';
          teamsContainer.appendChild(empty);
        } else {
          const heading = document.createElement('p');
          heading.className = 'manager-team-heading';
          heading.textContent = 'Teams';
          teamsContainer.appendChild(heading);

          const wrapper = document.createElement('div');
          wrapper.className = 'manager-team-table-scroll';

          const table = document.createElement('table');
          table.className = 'manager-team-table';
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');

          columns.forEach(col => {
            const th = document.createElement('th');
            th.textContent = formatColumnName(col);
            if (col === 'points') th.classList.add('is-primary-score');
            if (col === 'opponent') th.classList.add('is-opponent');
            headerRow.appendChild(th);
          });

          thead.appendChild(headerRow);

          const tbody = document.createElement('tbody');
          managerTeams.forEach(team => {
            const row = document.createElement('tr');
            columns.forEach(col => {
              const td = document.createElement('td');
              td.dataset.label = formatColumnName(col);
              if (col === 'points') td.classList.add('is-primary-score');
              if (col === 'opponent') td.classList.add('is-opponent');

              if (col === 'team') {
                const label = formatTeamLabel(team);
                const strong = document.createElement('strong');
                strong.className = 'manager-team-name';
                strong.textContent = label;
                td.appendChild(strong);

                if (team?.opponent) {
                  const opponentLabel = document.createElement('span');
                  opponentLabel.textContent = formatOpponentLabel(team);
                  td.appendChild(opponentLabel);
                }

                if (team?.manager) {
                  const managerLabel = document.createElement('span');
                  managerLabel.className = 'team-manager';
                  managerLabel.textContent = team.manager;
                  td.appendChild(managerLabel);
                }
              } else if (col === 'points') {
                const pointsToday = Number(team.points_today) || 0;
                const potentialPoints = Number(team.potential_points) || 0;
                td.textContent = `${team[col] + pointsToday ?? ''}`;

                if ((potentialPoints !== 0) && (potentialPoints !== pointsToday)) {
                  const pointsTodaySpan = document.createElement('span');
                  pointsTodaySpan.textContent = ` (+${potentialPoints})`;
                  td.appendChild(pointsTodaySpan);
                }

                if (pointsToday) {
                  const pointsTodaySpan = document.createElement('span');
                  pointsTodaySpan.className = pointsToday > 0 ? 'points-gain' : 'points-loss';
                  pointsTodaySpan.textContent = ` ${pointsToday > 0 ? '+' : ''}${pointsToday}`;
                  td.appendChild(pointsTodaySpan);
                }
              } else if (col === 'opponent') {
                td.textContent = formatOpponentLabel(team);
              } else {
                td.textContent = team[col] ?? '';
              }

              row.appendChild(td);
            });
            tbody.appendChild(row);
          });

          table.appendChild(thead);
          table.appendChild(tbody);
          wrapper.appendChild(table);
          teamsContainer.appendChild(wrapper);
        }

        details.appendChild(summary);
        details.appendChild(teamsContainer);
        dropdownList.appendChild(details);
      });
    }

    function renderTeamSearch(teams, filter = '') {
      const query = filter.trim().toLowerCase();
      const results = document.getElementById('searchResults');
      results.innerHTML = '';

      const filteredTeams = teams
        .filter(team => {
          if (!query) return true;
          const name = String(team?.team || '').toLowerCase();
          return name.includes(query);
        })
        .sort((a, b) => {
          const totalA = getTotalPoints(a);
          const totalB = getTotalPoints(b);
          if (totalB !== totalA) return totalB - totalA;
          return formatTeamLabel(a).localeCompare(formatTeamLabel(b));
        });

      if (!filteredTeams.length) {
        const empty = document.createElement('p');
        empty.className = 'empty-state';
        empty.textContent = 'No teams match your search.';
        results.appendChild(empty);
        return;
      }

      const table = document.createElement('table');
      table.className = 'manager-team-table';
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      searchColumns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = formatColumnName(col);
        if (col === 'points') th.classList.add('is-primary-score');
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      const tbody = document.createElement('tbody');
      filteredTeams.forEach(team => {
        const row = document.createElement('tr');
        searchColumns.forEach(col => {
          const td = document.createElement('td');
          td.dataset.label = formatColumnName(col);
          if (col === 'points') td.classList.add('is-primary-score');

          if (col === 'team') {
            const teamLabel = document.createElement('strong');
            teamLabel.textContent = formatTeamLabel(team);
            td.appendChild(teamLabel);

            if (team?.opponent) {
              const opponentLabel = document.createElement('span');
              opponentLabel.textContent = team.home_game ? ` vs ${team.opponent}` : ` @ ${team.opponent}`;
              td.appendChild(opponentLabel);
            }

            if (team?.manager) {
              const managerLabel = document.createElement('span');
              managerLabel.className = 'team-manager';
              managerLabel.textContent = team.manager;
              td.appendChild(managerLabel);
            }
          } else if (col === 'points') {
            const pointsToday = Number(team.points_today) || 0;
            const potentialPoints = Number(team.potential_points) || 0;
            td.textContent = `${team[col] + pointsToday ?? ''}`;

            if ((potentialPoints !== 0) && (potentialPoints !== pointsToday)) {
              const pointsTodaySpan = document.createElement('span');
              pointsTodaySpan.textContent = ` (+${potentialPoints})`;
              td.appendChild(pointsTodaySpan);
            }

            if (pointsToday) {
              const pointsTodaySpan = document.createElement('span');
              pointsTodaySpan.className = pointsToday > 0 ? 'points-gain' : 'points-loss';
              pointsTodaySpan.textContent = ` ${pointsToday > 0 ? '+' : ''}${pointsToday}`;
              td.appendChild(pointsTodaySpan);
            }
          } else if (col === 'opponent') {
            td.textContent = formatOpponentLabel(team);
          } else {
            td.textContent = team[col] ?? '';
          }

          row.appendChild(td);
        });
        tbody.appendChild(row);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      results.appendChild(table);
    }

    function formatLiveStatus(period, time) {
      const periodText = (period ?? '').toString().trim();
      const timeText = (time ?? '').toString().trim();

      if (periodText && timeText) {
        return `${periodText} | ${timeText}`;
      }
      if (periodText) return periodText;
      if (timeText) return timeText;
      return 'Scheduled';
    }

    function formatScoreValue(score) {
      if (score === null || typeof score === 'undefined' || score === '') {
        return 'â€”';
      }
      return score;
    }

    function renderLiveScores(liveScores = []) {
      const container = document.getElementById('liveScores');
      container.innerHTML = '';

      if (!Array.isArray(liveScores) || liveScores.length === 0) {
        const empty = document.createElement('p');
        empty.className = 'empty-state';
        empty.textContent = 'No games today.';
        container.appendChild(empty);
        return;
      }

      const wrapper = document.createElement('div');
      wrapper.className = 'manager-team-table-scroll live-scores-table';

      const table = document.createElement('table');
      table.className = 'manager-team-table';
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');

      liveScoreColumns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = formatColumnName(col);
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);

      const tbody = document.createElement('tbody');

      liveScores.forEach(game => {
        const row = document.createElement('tr');

        const awayLabel = formatRankedTeam(game.away_team, game.away_rank);
        const homeLabel = formatRankedTeam(game.home_team, game.home_rank);

        liveScoreColumns.forEach(col => {
          const td = document.createElement('td');
          td.dataset.label = formatColumnName(col);

          if (col === 'home') {
            td.innerHTML = `
              <strong>${homeLabel}</strong>
            `;
          } else if (col === 'score') {
            const awayScore = formatScoreValue(game.away_score);
            const homeScore = formatScoreValue(game.home_score);
            td.innerHTML = `<strong>${homeScore} - ${awayScore}</strong>`;
            const statusLabel = document.createElement('span');
            statusLabel.className = 'live-status';
            statusLabel.textContent = formatLiveStatus(game.period, game.time);
            td.appendChild(statusLabel);
          } else if (col === 'away') {
            td.innerHTML = `
              <strong>${awayLabel}</strong>
            `;
          }

          row.appendChild(td);
        });

        tbody.appendChild(row);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      wrapper.appendChild(table);
      container.appendChild(wrapper);
    }

    function setupTabs() {
      const buttons = Array.from(document.querySelectorAll('.tab-button'));
      const panels = Array.from(document.querySelectorAll('.tab-panel'));

      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const target = button.dataset.tab;
          buttons.forEach(b => {
            const isActive = b.dataset.tab === target;
            b.classList.toggle('is-active', isActive);
            b.setAttribute('aria-selected', isActive);
          });

          panels.forEach(panel => {
            const isPanelActive = panel.id === `${target}Tab`;
            panel.hidden = !isPanelActive;
            panel.classList.toggle('active', isPanelActive);
          });
        });
      });
    }

    function showError(message) {
      const errorEl = document.getElementById('error');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
    }

    function initialize() {
      setupTabs();

      google.script.run
        .withSuccessHandler(({ teams, managerTotals, managerDailyTotal, liveScores }) => {
          allTeams = teams || [];
          renderManagerDropdowns(managerTotals, teams, managerDailyTotal);
          renderTeamSearch(allTeams);
          renderLiveScores(liveScores || []);

          const searchInput = document.getElementById('teamSearch');
          searchInput.addEventListener('input', (event) => {
            renderTeamSearch(allTeams, event.target.value || '');
          });
        })
        .withFailureHandler(err => {
          const message = err && err.message ? err.message : 'Unable to load teams data.';
          showError(message);
        })
        .getTeamsPageData();
    }

    initialize();
  </script>
</body>
</html>
